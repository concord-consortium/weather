<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<!-- Your interface name here-->
	<title>Enactment Control</title>
	<!-- The description of this interfaces here -->
	<meta name="description" content="">
	<link rel="stylesheet" type="text/css" href="mystyle.css">
	<!-- Your CSS here -->
</head>
<body>
	<p align=left style="font-size:150%;">Enactment Control interface</p>
	<table cellpadding=5>
		<tr>
			<td align=right>Source:</td>
			<td align=left>
				<select style="color:black;" id="sources" onchange="setSourceMode();">
					<option>Boston area, July 5, 2016</option>
					<option>Alaska May 14, 2014</option>
					<option>Chicagoland yesterday</option>
					<option>Tom's 1-D simulation</option>
					<option>Tom's 2-D simulation</option>
				</select>
			</td>
			<td align=left style="color:yellow;font-size:100%;">
				Sources are of two types: records of prior weather events and simulations of weather events. We will need an interface for curation of sources. 
			</td>
		</tr>
		<tr>
			<td valign=top align=right>Window:</td>
			<td align=left>
				<img id="map" src="boston.jpg" width=400 height=250><br><img width=400 src="controls.jpg">
			</td>
			<td align=left style="color:yellow;font-size:100%;">
				Pan/zoom to select geographic area for mapping to the classroom. Add Quicktime-like controls to animate weather (selecting represented variables) and selecting time interval to be enacted. This defines the space and time of the enactment from the frame of the weather history. Include ability to overlay classroom map (variable opacity). This is really the full-blown imaging tool we want kids to have access to as well (at least eventually).
			</td>
		</tr>
		<tr>
			<td align=right>Enactment:</td>
			<td align=left >
				<input size=6 type=text id="period" value=1> minutes
			</td>
			<td align=left style="color:yellow;font-size:100%;">
				How much time the enactment described above will take in the classroom. 
			</td>
		</tr>
		<tr>
			<td align=right></td>
			<td align=left >
				<button id="run" onClick="runSimulation();">Start</button> <button id="stop" onCLick="stopSimulation();">Stop</button>
			</td>
			<td align=left style="color:yellow;font-size:100%;">
				Start and stop the enactment. 
			</td>
		</tr>
	</table>


				
	<!-- Scripts -->
	<script src="nutella_lib.js" type="text/javascript"></script>
	<script type="text/javascript">
	var query_parameters = NUTELLA.parseURLParameters();
	var nutella = NUTELLA.init(query_parameters.broker, query_parameters.app_id, query_parameters.run_id, NUTELLA.parseComponentId());
	// nutella.net.request('channel_names',{},function(message, from){
	// 	document.getElementById('channels').value = JSON.stringify(message,null,3);
	// })
	
	function setSourceMode(){
		if (document.getElementById('sources').selectedIndex == 0) {
			document.getElementById('map').src = "boston.jpg";
		};
		if (document.getElementById('sources').selectedIndex == 1) {
			document.getElementById('map').src = "alaska.jpg";
		};
		if (document.getElementById('sources').selectedIndex == 2) {
			document.getElementById('map').src = "overlay.jpg";
		};
		if (document.getElementById('sources').selectedIndex == 3) {
			document.getElementById('map').src = "1d-land.jpg";
		};
		if (document.getElementById('sources').selectedIndex == 4) {
			document.getElementById('map').src = "2d-land.jpg";
		};
	}

	var map =  [[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20],
				[20,20,20,20,20,20,20,20,20,20,20,20]
			   ];
	var step;

	nutella.net.handle_requests('current_temp',function(msg,from){return(map);});

	function stopSimulation () { 
		step = 12; 
		document.getElementById('run').disabled = false; 
		document.getElementById('stop').disabled = true;
	};

	function runSimulation(){
		document.getElementById('run').disabled = true; 
		document.getElementById('stop').disabled = false;
		for (var i=0; i<9; i++) {
			map[i] = [];
			for (var j=0; j<12; j++) map[i][j]=20;
		}
		step = 0;
		nutella.net.publish('temp_update',map);
		setTimeout(crank,document.getElementById('period').value * 60 *1000/12);
	}

	function crank () {
		for (var i=0; i<9; i++)
			for (var j=0; j<12; j++) {
				if (i == 1 || i == 2) map[i][j] = j <= ((2*step)-1) ? 30 : 20;
				if (i == 7) map [i][j] = j < (step-1) ? 10 : 20
		}
		step++;
		nutella.net.publish('temp_update',map);
		if (step <12) setTimeout(crank,document.getElementById('period').value * 60 *1000/12);


	}


	
	</script>
				
</body>
</html>
